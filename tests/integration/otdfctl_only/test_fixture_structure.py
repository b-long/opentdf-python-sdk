import pytest


@pytest.mark.integration
def test_test_data_directory_structure(tdf_v4_2_2_files, tdf_v4_3_1_files):
    """Test that the TDF files are properly generated by fixtures."""

    # Check v4.2.2 TDF files exist and are valid
    expected_v4_2_2_files = ["text", "binary", "with_attributes"]
    for file_key in expected_v4_2_2_files:
        assert file_key in tdf_v4_2_2_files, (
            f"v4.2.2 TDF file key should exist: {file_key}"
        )
        tdf_file_path = tdf_v4_2_2_files[file_key]
        assert tdf_file_path.exists(), f"v4.2.2 TDF file should exist: {tdf_file_path}"
        assert tdf_file_path.suffix == ".tdf", (
            f"File should have .tdf extension: {tdf_file_path}"
        )
        assert tdf_file_path.stat().st_size > 0, (
            f"TDF file should not be empty: {tdf_file_path}"
        )

    # Check v4.3.1 TDF files exist and are valid
    expected_v4_3_1_files = ["text", "binary", "with_attributes"]
    for file_key in expected_v4_3_1_files:
        assert file_key in tdf_v4_3_1_files, (
            f"v4.3.1 TDF file key should exist: {file_key}"
        )
        tdf_file_path = tdf_v4_3_1_files[file_key]
        assert tdf_file_path.exists(), f"v4.3.1 TDF file should exist: {tdf_file_path}"
        assert tdf_file_path.suffix == ".tdf", (
            f"File should have .tdf extension: {tdf_file_path}"
        )
        assert tdf_file_path.stat().st_size > 0, (
            f"TDF file should not be empty: {tdf_file_path}"
        )

    # Verify the TDF files are in the correct directory structure
    for file_path in tdf_v4_2_2_files.values():
        assert "v4.2.2" in str(file_path), (
            f"v4.2.2 TDF file should be in v4.2.2 directory: {file_path}"
        )

    for file_path in tdf_v4_3_1_files.values():
        assert "v4.3.1" in str(file_path), (
            f"v4.3.1 TDF file should be in v4.3.1 directory: {file_path}"
        )


@pytest.mark.integration
def test_sample_file_contents(sample_input_files):
    """Test that sample input files have expected content."""

    # Check text file has content
    text_file = sample_input_files["text"]
    assert text_file.exists(), f"Text file should exist: {text_file}"
    with open(text_file) as f:
        content = f.read()
    assert "Hello, World!" in content
    assert len(content) > 0

    # Check empty file is empty
    # empty_file = sample_input_files["empty"]
    # assert empty_file.exists(), f"Empty file should exist: {empty_file}"
    # assert empty_file.stat().st_size == 0

    # Check binary file exists and has content
    binary_file = sample_input_files["binary"]
    assert binary_file.exists(), f"Binary file should exist: {binary_file}"
    assert binary_file.stat().st_size > 0

    # Check attributes file has content
    attr_file = sample_input_files["with_attributes"]
    assert attr_file.exists(), f"Attributes file should exist: {attr_file}"
    with open(attr_file) as f:
        content = f.read()
    assert "Classification: SECRET" in content
